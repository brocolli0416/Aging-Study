---
title: "AgingStudy_analysisplan"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(lme4)
library(plyr)
library(jtools)
library(lmerTest)
## Load data files
# Summary data for both tasks
df = read.csv("./YAraw.csv") 
# Data for individual reaction times
rtdf = read.csv("./OA_rawRT.csv")
```

### Hypothesis
Pattern separation and statistical learning are two independent processes. Aging, which typically impaires the dentate gyrus and pattern separation, does not affect statistical learning which does not depend on the dentate gyrus.

**Prediction**: Older adults will be significantly worse at *lure discrimination* (but not recognition) on the auditory MST task compared to younger adults, but will perform just as well as the younger adults on the statistical learning task.

### Sample size calculation (GPower)

  
	F tests - ANOVA: Fixed effects, omnibus, one-way
	Analysis: A priori: Compute required sample size
	Input: Effect size f = 0.4200840
	α err prob = 0.05
	Power (1-β err prob) = 0.80
	Number of groups = 2
	Output:	Noncentrality parameter λ = 8.4705872
	Critical F = 4.0517487
	Numerator df = 1
	Denominator df = 46
	Total sample size	=	48
	Actual power = 0.8130553
	
**= 24 + 4 subjects per age group**

### Primary analysis
1. Group difference in lure discrimination
```{r Lure discrimination difference - GLM}
# Contrast code Age groups
df$Age = as.factor(df$Age)
df = mutate(df, coded_Age = Age)
contrasts(df$coded_Age) = contr.treatment(2)

# Run GLM
discrimination_model = lm(Disc ~ coded_Age, data = df)
summary(discrimination_model)
```

2. Group difference in Familiarity rating
```{r Familiarity difference - GLM}
df = mutate(df, fam_rating_diff = Word - Nonword)
# Run GLM
familiarity_model = lm(fam_rating_diff ~ coded_Age, data = df)
summary(familiarity_model)
```

3. Group difference in AFC accuracy
```{r AFC difference - GLM}
# Run GLM
AFC_model = lm(AFC ~ coded_Age, data = df)
summary(AFC_model)
```

4. Group difference in RT effect
```{r RT effect difference - GLM}
#rtdf = rtdf %>%
#  filter(Subject != '60dc4b08dd9ec36f5ca9e3fa')
rtdf[, 'Coded_Position'] = as.factor(rtdf[, 'Position'])
rtdf[, 'Coded_Occurrence'] = as.factor(rtdf[, 'Occurrence'])
#class(rtdf$Coded_Position)
contrasts(rtdf$Coded_Position) = contr.treatment(3)
contrasts(rtdf$Coded_Occurrence) = contr.sum(3)
#str(rtdf)

rtdf = mutate(rtdf, pos2 = case_when(Position == 1 ~ -1,
                                         Position == 2 ~ 1,
                                         Position == 3 ~ 0),
                    pos3 = case_when(Position == 1 ~ -1,
                                     Position == 2 ~ 0,
                                     Position == 3 ~ 1))

positionEffect = lmer(RT ~ Coded_Position + (1 + Coded_Position| Subject), data = rtdf)
positionEffect4 = lmer(RT ~  (1 + Coded_Position |Subject), data=rtdf)
contrast_model = lmer(RT ~ Coded_Position + (1 + Coded_Position | Subject), data = rtdf)
mutated_model = lmer(RT ~ (pos2+pos3) + (1 + pos2 + pos3 | Subject), data = rtdf)
summary(mutated_model)
summary(contrast_model)
#summ(positionEffect)
anova(mutated_model, contrast_model)

```
### Secondary analysis

1. Individual RT effect
```{r Individual RT effect}
subject_list = as.list(distinct(rtdf, Subject))
pvalue_list = data.frame(Subject = numeric(0), pval = numeric(0))
for (i in subject_list){
  for (x in i){
    single_subj = rtdf %>%
      filter(Subject == x)
    positionEffect = lm(RT ~ Coded_Position, data = single_subj)
    print(x)
    print(summary(positionEffect))
    pvalue = summary(positionEffect)$coefficients[3, 4]
    #pvalue_list[[length(pvalue_list)+1]] = c(x, pvalue)
    #pvalue_list = rbind(pvalue_list, c(x, pvalue))
    pvalue_list[nrow(pvalue_list)+1, ] = c(x, pvalue)
  }
}

# Output p-value for the difference between 1st and 3rd positions for each individual
write.table(pvalue_list, "./YA_rawRT.csv", append=TRUE, sep = ',')
```


#### Visualization
- Syllable effect
- Position effect
- Order + position interaction


